# Source: https://github.com/MichaelCade/90DaysOfDevOps/blob/main/2024/day16.md
Language: multiple

## Snippet: Generated Test Template in Python using Hedra
Description: This Python code is an example of a generated test template by Hedra. It includes a workflow class with placeholder methods for HTTP, HTTP2, and Playwright interactions, demonstrating the structure and tagging capabilities of Hedra tests.
Source: https://github.com/MichaelCade/90DaysOfDevOps/blob/main/2024/day16.md#2025-04-17_snippet_5
Language: python

```python
# Generated by Hedra - my_test.py
import os
from hedra import (
    Workflow, 
    step,
)
from hedra.core.engines import (
    HTTPResult,
    HTTP2Result,
    PlaywrightResult
)


class MyTest(Workflow):
    vus=1000
    duration='1m'
    tags={
        'service': 'myapi.com',
        'environment': 'staging'
    }
    
    @step()
    async def get_http(self) -> HTTPResult:
        return await self.client.http.get('<ADD_URL_HERE>')

    @step()
    async def get_http2(self) -> HTTP2Result:
        return await self.client.http2.get('<ADD_URL_HERE>')

    @step()
    async def goto_url(self) -> PlaywrightResult:
        return await self.client.playwright.goto('<ADD_URL_HERE>')
```

## Snippet: Implementing Multi-Protocol Performance Test Workflow in Python
Description: This code demonstrates a Hedra workflow class that simulates user interactions using HTTP/2, HTTP, and Playwright for UI testing. It includes methods for API and UI login, book and author searches, showcasing the ability to use multiple protocols concurrently.
Source: https://github.com/MichaelCade/90DaysOfDevOps/blob/main/2024/day16.md#2025-04-17_snippet_2
Language: python

```python
import os
from hedra import (
    Workflow, 
    step,
)
from hedra.core.engines import (
    HTTPResult,
    HTTP2Result,
    PlaywrightResult
)
from typing import Literal, Optional


class Test(Workflow):
    vus=1000
    duration='1m'
    username=os.getenv('USERNAME')
    password=os.getenv('PASSWORD')

    def get_book_title(self) -> Literal['Shakespeare Collected Works']:
        return 'Shakespeare Collected Works'
    
    @step()
    async def login_via_api(self) -> HTTP2Result:
        return await self.client.http2.post(
            'https://myapi.com/api/v1/login',
            auth=(
                self.username,
                self.password
            )
        )
    
    @step()
    async def login_via_ui(self) -> PlaywrightResult:
        await self.client.playwright.goto('https://myapi.com/login')

        await self.client.playwright.input_text(
            '[data-test-id="username-input"]',
            self.username
        )

        await self.client.playwright.input_text(
            '[data-test-id="password-input"]',
            self.password
        )

        return await self.client.playwright.click('[data-test-id="login-button"]')

    @step('login_via_api')
    async def get_book(
        self,
        auth_response: HTTP2Result
    ) -> HTTPResult:
        auth_token = response.headers.get('X-API-TOKEN')
        title = self.get_book_title()

        return await self.client.http.get(
            f'https://myapi.com/api/v1/books?title={title}',
            headers={
                'X-API-TOKEN': auth_token
            }
        )
    
    @step('login_via_api')
    async def get_author(
        self,
        auth_response: HTTP2Result
    ) -> HTTPResult:
        auth_token = response.headers.get('X-API-TOKEN')

        return await self.client.http.get(
            'https://myapi.com/api/v1/authors?author=william&shakespeare',
            headers={
                'X-API-TOKEN': auth_token
            }
        )
    
    @step('login_via_ui')
    async def get_author_and_book_via_search(self) -> PlaywrightResult:
        await self.client.playwright.click('[data-test-id="author-search"]')
        await self.client.playwright.input_text(
            '[data-test-id="author-search-input"]',
            'William Shakespeare'
        )


        title = self.get_book_title()
        await self.client.playwright.click('[data-test-id="book-search"]')
        await self.client.playwright.input_text(
            '[data-test-id="book-search-input"]',
            title
        )

        return await self.client.playwright.click('[data-test-id="search-button"]')
```

## Snippet: Implementing API-Level Test Workflow in Python with Hedra
Description: This snippet demonstrates how to create a workflow-based test that simulates an authorized user searching for a book by author. It uses Hedra's workflow model to define concurrent test steps with dependencies between them, showing how API interactions can be structured as a graph rather than sequential operations.
Source: https://github.com/MichaelCade/90DaysOfDevOps/blob/main/2024/day16.md#2025-04-17_snippet_0
Language: python

```python
# An example simulating, from API level, an authorized user
# searching for a book by author.

import os
from hedra import (
    Workflow, 
    step,
)
from hedra.core.engines import (
    HTTPResult,
    HTTP2Result
)
from typing import Literal, Optional


class Test(Workflow):
    vus=1000
    duration='1m'
    username=os.getenv('USERNAME')
    password=os.getenv('PASSWORD')

    def get_book_title(self) -> Literal['Shakespeare Collected Works']:
        return 'Shakespeare Collected Works'
    
    @step()
    async def login_via_api(self) -> HTTP2Result:
        return await self.client.http2.post(
            'https://myapi.com/api/v1/login',
            auth=(
                self.username,
                self.password
            )
        )

    @step('login_via_api')
    async def get_book(
        self,
        auth_response: HTTP2Result
    ) -> HTTPResult:
        auth_token = response.headers.get('X-API-TOKEN')
        title = self.get_book_title()

        return await self.client.http.get(
            f'https://myapi.com/api/v1/books?title={title}',
            headers={
                'X-API-TOKEN': auth_token
            }
        )
    
    @step('login_via_api')
    async def get_author(
        self,
        auth_response: HTTP2Result
    ) -> HTTPResult:
        auth_token = response.headers.get('X-API-TOKEN')

        return await self.client.http.get(
            'https://myapi.com/api/v1/authors?author=william&shakespeare',
            headers={
                'X-API-TOKEN': auth_token
            }
        )
```

## Snippet: Generating Test Template with Hedra CLI in Bash
Description: This bash command demonstrates how to use Hedra's CLI to generate a test template with specified protocols and tags. It showcases the code generation feature for rapid test prototyping.
Source: https://github.com/MichaelCade/90DaysOfDevOps/blob/main/2024/day16.md#2025-04-17_snippet_4
Language: bash

```bash
hedra test generate my-test --using http,http2,playwright --tags service=myapi.com,environment=staging
```

## Snippet: Submitting Hedra Test to Project Repository in Bash
Description: This bash command shows how to submit a Hedra test to a project repository using the CLI, demonstrating the project management features of Hedra for organizing and versioning tests.
Source: https://github.com/MichaelCade/90DaysOfDevOps/blob/main/2024/day16.md#2025-04-17_snippet_7
Language: bash

```bash
hedra test submit my_test.py --project github.com/myorg/tests

Submitting my_test.py to github.com/myorg/tests...
Repo updated!
```

## Snippet: Executing Hedra Test on Remote Cluster in Bash
Description: This bash command demonstrates how to execute a Hedra test on a remote cluster using the CLI, showcasing the RPC remote execution capability for distributed testing scenarios.
Source: https://github.com/MichaelCade/90DaysOfDevOps/blob/main/2024/day16.md#2025-04-17_snippet_8
Language: bash

```bash
hedra cloud test my_test.py --send staging

Sending to - staging - cluster at 155.020.313.33:6883
```

## Snippet: Linting Hedra Test in Bash
Description: This bash command demonstrates how to use Hedra's CLI to lint a test file, showcasing the built-in linting feature for maintaining code quality in performance tests.
Source: https://github.com/MichaelCade/90DaysOfDevOps/blob/main/2024/day16.md#2025-04-17_snippet_6
Language: bash

```bash
hedra test lint my_test.py

Linting my_test.py...
OK!
```

## Snippet: Comparing Sequential vs Concurrent Workflow Models
Description: This snippet presents a comparison between sequential and concurrent workflow approaches for testing. It illustrates how sequential steps oversimplify actual system behavior, while concurrent workflows better represent the complex, parallel operations that occur in modern applications.
Source: https://github.com/MichaelCade/90DaysOfDevOps/blob/main/2024/day16.md#2025-04-17_snippet_1
Language: text

```text
# As sequential steps
[Authorized User Search] -> 
[Get API Token] -> 
[Search for Author] -> 
[Search for Book]

# As a concurrent workflow

[Authorized User Search] -> 
[Get API Token] -> 
[Search cache for popular authors, send search analytics, hit third party search API via fan out] -> 
[Search cache for matching popular books, send search analytics, hit third party search API via fan out]
```

## Snippet: Implementing Multi-Integration Reporting in Python with Hedra
Description: This code snippet demonstrates how to set up multiple reporting integrations (JSON, Datadog, Kafka) for performance test results using Hedra. It also includes a method to calculate and report the median API vs UI timing ratio.
Source: https://github.com/MichaelCade/90DaysOfDevOps/blob/main/2024/day16.md#2025-04-17_snippet_3
Language: python

```python
import os
import statistics
from hedra import (
    Workflow, 
    step
    Metric
)
from hedra.core.engines import (
    HTTPResult,
    HTTP2Result,
    PlaywrightResult
)
from hedra.reporting (
    JSONResults,
    DatadogResults,
    KafkaResults
)
from typing import List


@depends(Test)
class SubmitResults(Workflow):
    reporters=[
        JSONResults(
            path='./events.json'
        ),
        DatadogResults(
            api_key=os.getenv('DD_API_KEY'),
            app_key=os.getenv('DD_APP_KEY')
        ),
        KafkaResults(
            host=os.getenv('KAFKA_HOST'),
            topic='myapi_testing_results'
        )
    ]

    @step()
    async def ui_vs_api_timing(
        self,
        results: List[
            HTTPResult |
            HTTP2Result |
            PlaywrightResult
        ]
    ) -> Metric['median_api_vs_ui_time_ratio']:

        avg_api_timing = statistics.median([
            result.total_time for result in results if isinstance(
                result,
                (HTTPResult, HTTP2Result)
            )
        ])

        ui_timings = statistics.median([
            result.total_time for result in results if isinstance(
                result,
                PlaywrightResult
            )
        ])

        return avg_api_timing/ui_timings
```